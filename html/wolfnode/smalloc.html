<!DOCTYPE html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <title>WolfScript API smalloc</title>

  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link href="../assets/css/docs.css" rel="stylesheet" />
  <link href="../assets/css/github.css" rel="stylesheet" />
  <link href="../assets/fonts/foundation-icons.css" rel="stylesheet" />
   <script src="../assets/js/vendor/modernizr.js"></script>
</head>
<body>
  <body class="antialiased hide-extras">
    <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>
  <ul class="title-area">
    <li class="name">
      <h1><a href="/web/index.html"><i class="fi-paw"></i> WolfScript.io</a></h1>
    </li>
  </ul>

  <section class="top-bar-section">
    <ul class="right">
      <li class="divider"></li>
         <li class='divider'></li>
<li><a href='../index.html' class=''>Docs</a></li>
<li class='divider'></li>
<li><a href='../wolfbuk/io/wolfscript/0.html' class=''>WolfBuk API</a></li>
<li class='divider'></li>
<li><a href='../wolfcanary/io/wolfscript/0.html' class=''>WolfCanary API</a></li>
<li class='divider'></li>
<li><a href='../wolfnode/globals.html' class=''>WolfNode</a></li>

       <li class="divider"></li>
       <li><a href='http://github.com/miningwolf/wolfscript ' class=''> <i class="fi-social-github"></i> Github</a></li>
       <li class="divider"></li>
       <li class="has-form">
       <a href="../GettingStarted.html " class="small button">Getting Started</a>
       </li>
    </ul>
  </section>
</nav>
<ul class="breadcrumbs">
<li><a href='../index.html'>Docs </a></li>
 <li><a href='../wolfnode/globals.html'>wolfnode</a></li>
<li class='current'><a href='#'>smalloc</a></li>

</ul>

      <div class="row">
        <div class="large-3 medium-4 columns">
          <div class="hide-for-small">
            <div class="sidebar">
              <nav>
                <ul class="side-nav accordion" data-accordion>
                  <li class='heading'><a href='../wolfnode/globals.html' class=''>WolfNode</a></li> 
<li class='divider'></li>
<li class='heading'><a href='../wolfnode/buffer.html' class=''>Core</a></li> 
<li class='divider'></li>
<li class='heading'><a href='../wolfnode/assert.html' class=''>Other</a></li> 
<li><a href='../wolfnode/assert.html'>assert</a></li>
<li><a href='../wolfnode/child_process.html'>child_process</a></li>
<li><a href='../wolfnode/cluster.html'>cluster</a></li>
<li><a href='../wolfnode/debugger.html'>debugger</a></li>
<li><a href='../wolfnode/domain.html'>domain</a></li>
<li><a href='../wolfnode/os.html'>os</a></li>
<li><a href='../wolfnode/punycode.html'>punycode</a></li>
<li><a href='../wolfnode/readline.html'>readline</a></li>
<li><a href='../wolfnode/repl.html'>repl</a></li>
<li class='active'><a href='../wolfnode/smalloc.html'>smalloc</a></li>
<li><a href='../wolfnode/string_decoder.html'>string_decoder</a></li>
<li><a href='../wolfnode/tty.html'>tty</a></li>
<li><a href='../wolfnode/vm.html'>vm</a></li>
<li><a href='../wolfnode/zlib.html'>zlib</a></li>
<li class='divider'></li>

                  </ul>
              </nav>
            </div>
          </div>
        </div>
        <div class="large-9 medium-8 columns">
          <section class="doc-content">
            <h1 id="smalloc">Smalloc</h1>
<pre><code><span class="hljs-attribute">Stability</span>: <span class="hljs-string">1 - Experimental</span>
</code></pre><h2 id="class-smalloc">Class: smalloc</h2>
<p>Buffers are backed by a simple allocator that only handles the assignation of
external raw memory. Smalloc exposes that functionality.</p>
<h3 id="smalloc-alloc-length-receiver-type-">smalloc.alloc(length[, receiver][, type])</h3>
<ul>
<li><code>length</code> {Number} <code>&lt;= smalloc.kMaxLength</code></li>
<li><code>receiver</code> {Object} Default: <code>new Object</code></li>
<li><code>type</code> {Enum} Default: <code>Uint8</code></li>
</ul>
<p>Returns <code>receiver</code> with allocated external array data. If no <code>receiver</code> is
passed then a new Object will be created and returned.</p>
<p>This can be used to create your own Buffer-like classes. No other properties are
set, so the user will need to keep track of other necessary information (e.g.
<code>length</code> of the allocation).</p>
<pre><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SimpleData</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">this</span>.length = n;
  smalloc.alloc(<span class="hljs-keyword">this</span>.length, <span class="hljs-keyword">this</span>);
}

SimpleData.prototype = { <span class="hljs-comment">/* ... */</span> };
</code></pre><p>It only checks if the <code>receiver</code> is an Object, and also not an Array. Because of
this it is possible to allocate external array data to more than a plain Object.</p>
<pre><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allocMe</span><span class="hljs-params">()</span></span> { }
smalloc.alloc(<span class="hljs-number">3</span>, allocMe);

// { [Function allocMe] <span class="hljs-string">'0'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'1'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'2'</span>: <span class="hljs-number">0</span> }
</code></pre><p>v8 does not support allocating external array data to an Array, and if passed
will throw.</p>
<p>It&#39;s possible to specify the type of external array data you would like. All
possible options are listed in <code>smalloc.Types</code>. Example usage:</p>
<pre><code><span class="hljs-reserved">var</span> doubleArr = smalloc.alloc(<span class="hljs-number">3</span>, smalloc.Types.Double);

<span class="hljs-keyword">for</span> (<span class="hljs-reserved">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++)
  doubleArr = i / <span class="hljs-number">10</span>;

<span class="hljs-regexp">//</span> { <span class="hljs-string">'0'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'1'</span>: <span class="hljs-number">0.1</span>, <span class="hljs-string">'2'</span>: <span class="hljs-number">0.2</span> }
</code></pre><p>It is not possible to freeze, seal and prevent extensions of objects with
external data using <code>Object.freeze</code>, <code>Object.seal</code> and
<code>Object.preventExtensions</code> respectively.</p>
<h3 id="smalloc-copyonto-source-sourcestart-dest-deststart-copylength-">smalloc.copyOnto(source, sourceStart, dest, destStart, copyLength);</h3>
<ul>
<li><code>source</code> {Object} with external array allocation</li>
<li><code>sourceStart</code> {Number} Position to begin copying from</li>
<li><code>dest</code> {Object} with external array allocation</li>
<li><code>destStart</code> {Number} Position to begin copying onto</li>
<li><code>copyLength</code> {Number} Length of copy</li>
</ul>
<p>Copy memory from one external array allocation to another. No arguments are
optional, and any violation will throw.</p>
<pre><code><span class="hljs-reserved">var</span> a = smalloc.alloc(<span class="hljs-number">4</span>);
<span class="hljs-reserved">var</span> b = smalloc.alloc(<span class="hljs-number">4</span>);

<span class="hljs-keyword">for</span> (<span class="hljs-reserved">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
  a[i] = i;
  b[i] = i * <span class="hljs-number">2</span>;
}

<span class="hljs-regexp">//</span> { <span class="hljs-string">'0'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'1'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'2'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'3'</span>: <span class="hljs-number">3</span> }
<span class="hljs-regexp">//</span> { <span class="hljs-string">'0'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'1'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'2'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'3'</span>: <span class="hljs-number">6</span> }

smalloc.copyOnto(b, <span class="hljs-number">2</span>, a, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>);

<span class="hljs-regexp">//</span> { <span class="hljs-string">'0'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'1'</span>: <span class="hljs-number">6</span>, <span class="hljs-string">'2'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'3'</span>: <span class="hljs-number">3</span> }
</code></pre><p><code>copyOnto</code> automatically detects the length of the allocation internally, so no
need to set any additional properties for this to work.</p>
<h3 id="smalloc-dispose-obj-">smalloc.dispose(obj)</h3>
<ul>
<li><code>obj</code> Object</li>
</ul>
<p>Free memory that has been allocated to an object via <code>smalloc.alloc</code>.</p>
<pre><code>var a = {};
smalloc.alloc<span class="hljs-comment">(3, a)</span>;

<span class="hljs-comment">// { '0': 0, '1': 0, '2': 0 }</span>

smalloc.dispose<span class="hljs-comment">(a)</span>;

<span class="hljs-comment">// {}</span>
</code></pre><p>This is useful to reduce strain on the garbage collector, but developers must be
careful. Cryptic errors may arise in applications that are difficult to trace.</p>
<pre><code><span class="hljs-variable"><span class="hljs-keyword">var</span> a</span> = smalloc.alloc(<span class="hljs-number">4</span>);
<span class="hljs-variable"><span class="hljs-keyword">var</span> b</span> = smalloc.alloc(<span class="hljs-number">4</span>);

<span class="hljs-comment">// perform this somewhere along the line</span>
smalloc.dispose(b);

<span class="hljs-comment">// now trying to copy some data out</span>
smalloc.copyOnto(b, <span class="hljs-number">2</span>, a, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>);

<span class="hljs-comment">// now results in:</span>
<span class="hljs-comment">// RangeError: copy_length &gt; source_length</span>
</code></pre><p>After <code>dispose()</code> is called object still behaves as one with external data, for
example <code>smalloc.hasExternalData()</code> returns <code>true</code>.
<code>dispose()</code> does not support Buffers, and will throw if passed.</p>
<h3 id="smalloc-hasexternaldata-obj-">smalloc.hasExternalData(obj)</h3>
<ul>
<li><code>obj</code> {Object}</li>
</ul>
<p>Returns <code>true</code> if the <code>obj</code> has externally allocated memory.</p>
<h3 id="smalloc-kmaxlength">smalloc.kMaxLength</h3>
<p>Size of maximum allocation. This is also applicable to Buffer creation.</p>
<h3 id="smalloc-types">smalloc.Types</h3>
<p>Enum of possible external array types. Contains:</p>
<ul>
<li><code>Int8</code></li>
<li><code>Uint8</code></li>
<li><code>Int16</code></li>
<li><code>Uint16</code></li>
<li><code>Int32</code></li>
<li><code>Uint32</code></li>
<li><code>Float</code></li>
<li><code>Double</code></li>
<li><code>Uint8Clamped</code></li>
</ul>


          </section>
        </div>
      </div>
    </div>
    <script src="../assets/js/vendor/jquery.js"></script>
    <script src="../assets/js/vendor/fastclick.js"></script>
    <script src="../assets/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
  </body>
  </html>